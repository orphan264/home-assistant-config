- id: 70f2d33d43304037baaf52f5cfa8c6e4
  alias: David - Workday Alarm
  description: =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.time'') == (state_attr(''input_datetime.alarm_time_david'',
      ''timestamp'') | int | timestamp_custom(''%H:%M'', False)) }}'
  condition:
  - condition: state
    entity_id: person.david
    state: home
  - condition: state
    entity_id: binary_sensor.workday_david
    state: 'on'
  action:
  - service: script.sonos_say
    data_template:
      sonos_entity: media_player.bedroom
      volume: 0.4
      message: Good Morning David! Time to wake up!
  - delay: 00:00:10
  - service: media_player.volume_set
    data:
      entity_id: media_player.bedroom
      volume_level: 0.18
  - service: media_player.select_source
    data:
      entity_id: media_player.bedroom
      source: Summer Hits of the 80s Radio
  - delay: 00:50:00
  - service: media_player.media_stop
    data:
      entity_id: media_player.bedroom
  mode: single
- id: 837435e7dfd748d5b4379c031f5606f0
  alias: Sunset minus thirty minutes
  description: =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  trigger:
  - platform: sun
    event: sunset
    offset: -00:30:15
  action:
  - service: script.sonos_announce
    data_template:
      message: '{{ [ "Preparing for sunset. Have a pleasant evening!",  "The sun will
        be setting shortly. Enjoy your evening!", "Here comes the night. Don''t worry!
        I will take care of the lights!", "Activating evening lights! Don''t stay
        up too late!", "That''s OK, You relax, I will take care of the lights." ]
        |random }}'
  mode: single
- id: storelastrain
  alias: Save the date and time of last rain
  description: =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  trigger:
  - platform: state
    entity_id: weather.home
  condition:
  - condition: template
    value_template: '{{ ''rainy'' in trigger.from_state.state or ''rainy'' in trigger.to_state.state
      }}'
  action:
  - service: input_datetime.set_datetime
    entity_id: input_datetime.last_rain
    data_template:
      datetime: '{{ now().strftime(''%Y-%m-%d %H:%M:%S'') }}'
  mode: single
- id: New Device Tracked
  alias: New Device Tracked
  description: =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  trigger:
  - platform: event
    event_type: device_tracker_new_device
  condition: []
  action:
  - service: persistent_notification.create
    data_template:
      title: 'Newly tracked: {{trigger.event.data.entity_id}}

        '
      message: 'New device tracked: ({{trigger.event.data.entity_id}}) Host: {{trigger.event.data.host_name}}
        Mac-address: {{trigger.event.data.mac}} Data: {{trigger.event.data}}

        '
  mode: single
- id: Process Default Changes for Lights
  alias: Monitor - Default Lights
  description: =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  trigger:
  - entity_id: sensor.default_dining_room_table_lamp
    platform: state
  - entity_id: sensor.default_exterior_shop_light
    platform: state
  - entity_id: sensor.default_exterior_driveway_light
    platform: state
  - entity_id: sensor.default_living_room_table_lamps
    platform: state
  - entity_id: sensor.default_living_room_corner_lamp
    platform: state
  - entity_id: sensor.default_study_table_lamp
    platform: state
  - entity_id: sensor.default_bedroom_table_lamp
    platform: state
  - entity_id: sensor.default_guest_bedroom_table_lamp
    platform: state
  condition: []
  action:
  - service: script.set_light_to_default
    data:
      mysensor: '{{trigger.to_state.entity_id }}'
  mode: parallel
  max: 10
- id: Process Default Changes for Switches
  alias: Monitor - Default Switches
  description: =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  trigger:
  - entity_id: binary_sensor.default_studio_parlour_floor_lamp
    platform: state
  - entity_id: binary_sensor.default_porch
    platform: state
  - entity_id: binary_sensor.default_christmas_tree
    platform: state
  condition: []
  action:
  - service: script.set_switch_to_default
    data:
      mysensor: '{{trigger.to_state.entity_id }}'
  mode: parallel
  max: 10
- id: '1609085637484'
  alias: Someone has come home
  description: =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  trigger:
  - platform: state
    entity_id: person.amy
    to: home
  - platform: state
    entity_id: person.david
    to: home
  condition: []
  action:
  - service: script.arrive_home_anyone
    data: {}
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.entity_id == "person.amy" }}'
      sequence:
      - service: script.arrive_home_amy
        data: {}
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.entity_id == "person.david" }}'
      sequence:
      - service: script.arrive_home_david
        data: {}
    default: []
  mode: queued
  max: 5
- id: '1609091851036'
  alias: Monitor - Washing Machine
  description: =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  trigger:
  - platform: numeric_state
    entity_id: sensor.washer_power
    above: '15'
    for: 00:00:30
  - platform: numeric_state
    entity_id: sensor.washer_power
    below: '15'
    for: 00:02:00
  condition: []
  action:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.washer_power
        above: '15'
      sequence:
      - service: input_select.select_option
        data:
          entity_id: input_select.state_washingmachine
          option: Washing
      - service: switch.turn_on
        data:
          entity_id: switch.laundry_light
    - conditions:
      - condition: numeric_state
        entity_id: sensor.washer_power
        below: '15'
      - condition: state
        entity_id: input_select.state_washingmachine
        state: Washing
      sequence:
      - service: input_select.select_option
        data:
          entity_id: input_select.state_washingmachine
          option: Ready
      - service: script.sonos_announce
        data:
          message: The washing machine has finished and is ready to be emptied!
      - service: switch.turn_on
        data:
          entity_id: switch.laundry_light
    default: []
  mode: single
- id: '1609099392133'
  alias: Monitor - Shop Door
  description: =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  trigger:
  - platform: state
    entity_id: binary_sensor.shop_door
  condition:
  - condition: state
    entity_id: binary_sensor.tod_overnight
    state: 'on'
  action:
  - service: light.turn_on
    data:
      entity_id: light.exterior_shop_light
      brightness_pct: 100
  mode: single
